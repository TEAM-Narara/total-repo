# SuperBoard <br>실시간 WorkFlow 관리 서비스
SSAFY 11기 삼성 SDI 연계 프로젝트 

## 📜 Contents
 1. [프로젝트 개요](#1️⃣프로젝트-개요)
 2. [주요 기능](#2️⃣주요-기능)
 3. [개발 환경](#3️⃣개발-환경)
 4. [기술 특이점](#4️⃣기술-특이점)
 5. [산출물](#5️⃣산출물)
 6. [팀원 소개](#6️⃣팀원-소개)

## 1️⃣프로젝트 개요
### 프로젝트 기간
2024.10.08 ~ 2024.11.19 (6주)

### 프로젝트 소개
SuperBoard는 팀 협업을 지원하는 실시간 WorkFlow 관리 서비스로, 보드, 리스트, 카드 등을 통해 작업을 시각적으로 관리할 수 있습니다. 사용자 간 실시간 변경 사항 공유와 알림 기능을 통해 효율적인 협업 환경을 제공합니다.


### 기획의도
SuperBoard는 직관적이고 접근성이 높은 프로젝트 관리 도구로, 드래그 앤 드롭 방식의 간단한 칸반 스타일 인터페이스를 통해 시각적으로 작업을 관리할 수 있습니다. 실시간 협업 및 동기화 기능을 제공하여 원격 환경에서도 팀워크를 원활히 지원합니다. 기술 수준에 관계없이 누구나 쉽게 사용할 수 있으며, 모바일 친화적으로 설계되어 언제 어디서나 프로젝트를 모니터링하고 관리할 수 있습니다.


## 2️⃣주요 기능 
- 워크스페이스, 보드, 리스트, 카드 생성 및 관리 기능
- 실시간 변경 사항 공유 (카드 수정, 댓글 추가, 첨부파일 등)
- 워크스페이스 및 보드 초대와 작업 변경에 대한 알림 기능
- 보드 배경 및 카드 커버 커스터마이징 (이미지 및 색상)
- 팀원의 역할에 따른 권한 기반 접근 제어와 협업 지원


## 3️⃣개발 환경

|   TYPE    | SKILL           | VERSION          |
| :-------: | :-------------- | :--------------- |
| LANGUAGES | Java            | 21               |
|           | Kotlin          | 2.0.21.          |
|    BE     | Spring Boot     | 3.3.5            |
|           | Spring Data JPA |                  |
|           | QueryDSL        | 5.0.0            |
|    FE     | Android (Kotlin) | ?               |
| DATABASE  | PostgreSQL(RDS) | 16.0             |
|           | MongoDB           | 4.0            |
|           | ElasticCache Redis| 7.1            |
|   INFRA   | AWS EC2         | ubuntu(x86)      |
|           | Jenkins         | 2.479            |
|           | Nginx           |                  |
|           | Docker          | 24.0.7           |
|           | Kafka           | bitnami/kafka:3.8|
|           | kafka-WebUi     | provectuslabs/kafka-ui|
|           | sonarqube       |                  |

## 4️⃣ 기술 특이점


### 1️⃣ **실시간 동기화**

- **문제**  
    - 팀원이 작업을 실시간으로 확인해야 하는 환경에서 **Polling** 방식은 매번 서버에 요청을 보내야 하며, 변경사항이 없더라도 불필요한 요청을 처리해야 하므로 비효율적.  
    - **SSE(Server-Sent Events)**는 서버에서 클라이언트로 변경사항을 즉각 전달할 수 있지만, 양방향 통신이 불가능하여 한계가 있음.  
    - **WebSocket**을 사용할 경우 데이터 유실, 순서 보장, 오프라인 상태 복구 등 여러 안정성 문제가 발생할 수 있음.

- **해결법**
    - **WebSocket을 활용한 실시간 동기화**
        - 클라이언트와 서버 간 지속적인 연결을 유지해 변경사항을 즉각적으로 동기화.
        - 추가 요청 없이 데이터를 빠르게 주고받아 성능을 극대화.
    - **Kafka를 통한 순서 보장**
        - 다수의 사용자가 동시에 작업할 경우 변경사항의 순서를 보장하기 위해 Kafka를 도입.
        - Kafka는 변경사항을 순서대로 저장하고 관리하며, 이를 소켓을 통해 클라이언트로 전달.
    - **ACK(Acknowledgment) 활용으로 데이터 유실 방지**
        - 클라이언트와 서버가 메시지 수신 성공 여부를 확인.
        - ACK 누락 시 Kafka와 Redis 대기열을 통해 재전송을 시도하여 안정성 확보.
    - **Redis 대기열로 요청 순서 관리**
        - 요청이 순서대로 처리되도록 Redis 대기열을 사용.
        - 네트워크 상태에 따라 ACK 순서가 어긋나는 문제를 방지하기 위해 약 3초의 유예 시간을 두어 누락된 요청을 복구.

- #### **전체 통신 구조**

1. **클라이언트 요청 전송**
    - 클라이언트가 작업을 수행하면 Http 통신을 통해 데이터를 서버로 전송.

2. **Kafka에 저장 및 순서 관리**
    - 서버는 수신한 데이터를 Kafka에 저장하여 변경 사항의 순서를 보장.

3. **변경 사항 처리 및 전달**
    - Kafka에서 데이터를 읽어들여 변경 사항을 처리하고 클라이언트로 전달할 준비.

4. **WebSocket으로 실시간 전달**
    - 서버는 WebSocket을 통해 변경 사항을 보드 내 모든 사용자에게 실시간으로 전달.

5. **ACK 확인 및 안정성 확보**
    - 클라이언트는 변경 사항을 수신한 후 ACK를 서버로 전달해 데이터 수신 여부를 알림.
    - Redis 대기열을 활용해 누락된 요청을 3초간 대기하며 복구 시도.

6. **오프라인 모드 데이터 병합**
    - 클라이언트가 다시 온라인 상태로 전환되면, 로컬 데이터와 서버 데이터를 동기화.


### 2️⃣ **편리하고 직관적인 UI**

- **문제**
    - 사용자가 리스트나 카드를 드래그 앤 드롭할 때, 동시 작업 시 충돌(reject)이 자주 발생.
    - 여러 사용자가 동시에 카드를 이동하면 순서 충돌 문제가 발생.

- **해결법**
    - **거지수 방식**
        - 리스트나 카드의 순서를 나타내는 고유 숫자를 연속적(1, 2, 3)으로 부여하지 않고 충분히 큰 간격(예: 100, 200, 300)으로 할당.
        - 중간에 항목을 삽입할 경우, 기존 숫자를 수정하지 않고 간격의 중간값(예: 150)을 부여해 효율적 관리.
    - **랜덤 오프셋 추가**
        - 다수의 사용자가 동시에 드래그 앤 드롭을 수행하는 경우, 같은 숫자가 부여될 가능성을 줄이기 위해 랜덤 오프셋을 적용.
        - 예를 들어, 숫자 간 중간값을 계산한 후 약간의 랜덤 값을 추가하여 충돌 가능성을 낮춤.


### 3️⃣ **오프라인 모드**

- **문제**
    - 네트워크 연결이 없는 상태에서 작업한 내용을 저장해야 함.
    - 서버와 다시 연결되었을 때, 클라이언트와 서버 간 변경 사항 동기화 문제 발생.
    - 변경된 데이터와 기존 데이터의 충돌 여부를 구분해야 함.

- **해결법**
    - **클라이언트 DB 사용(Room DB)**
        - 클라이언트 측에 데이터베이스를 두어 오프라인 상태에서도 작업 가능.
        - Room DB를 사용해 로컬에 데이터를 저장하고, 서버 연결 시 동기화.
    - **비트 마스킹을 활용한 변경 사항 추적**
        - 각 데이터의 상태를 비트로 관리하여 변경된 항목을 추적.
        - 예: `0001`은 추가, `0010`은 수정, `0100`은 삭제와 같이 상태를 구분.
    - **상태 관리 변수 컬럼 추가**
        - 데이터베이스에 상태를 나타내는 별도의 컬럼을 추가.
        - 변경 사항 동기화 시, 해당 컬럼을 기준으로 서버와 클라이언트 간 충돌 여부를 확인.
    - **변경 사항 병합 알고리즘**
        - 서버와 클라이언트 데이터의 마지막 업데이트 시간을 비교하여 최신 데이터를 기준으로 병합.
        - 충돌 발생 시 사용자가 우선순위를 지정할 수 있도록 설계.


## 5️⃣산출물 

### 아키텍처
![시스템 구조도](/image/시스템구조도.png)


## 6️⃣팀원 소개

|  이름  | 역할                                                                             |
| :----: | :------------------------------------------------------------------------------- |
| 조시현 | 팀장, Backend, Infra |
| 주효림 | Backend |
| 남경민 | Backend |
| 박준식 | Android |
| 최승준 | Android |
| 정다혜(~ 10.31) | Android |
| 여창민(10.30 ~) | Android |
